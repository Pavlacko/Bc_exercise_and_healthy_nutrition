@model Bc_exercise_and_healthy_nutrition.ViewModels.DiaryIndexViewModel

@{
    ViewData["Title"] = "Denník stravy";
}

<h2>Denník stravy</h2>

<div class="row">
    <div class="col-md-4">
        <label class="form-label">Dátum</label>
        <input id="diaryDate" type="date" class="form-control" value="@Model.Date.ToString("yyyy-MM-dd")" />
    </div>
</div>

<hr />

<div class="row">
    <div class="col-md-6">
        <h4>Pridať jedlo</h4>

        <div class="mb-3">
            <label class="form-label">Jedlo</label>
            <select id="foodSelect" class="form-select">
                @foreach (var item in Model.Foods)
                {
                    <option value="@item.Value">@item.Text</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Gramáž (g)</label>
            <input id="gramsInput" type="number" class="form-control" min="1" max="5000" value="100" />
        </div>

        <button id="addEntryBtn" class="btn btn-primary">Pridať</button>
        <div id="addError" class="text-danger mt-2" style="display:none;"></div>
    </div>

    <div class="col-md-6">
        <h4>Denný súhrn</h4>
        <div class="border rounded p-3">
            <div>Počet položiek: <strong id="sumCount">0</strong></div>
            <div>Kcal: <strong id="sumKcal">0</strong></div>
            <div>Proteín: <strong id="sumP">0</strong> g</div>
            <div>Sacharidy: <strong id="sumC">0</strong> g</div>
            <div>Tuky: <strong id="sumF">0</strong> g</div>
        </div>
    </div>
</div>

<hr />

<h4>Záznamy</h4>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Jedlo</th>
            <th>g</th>
            <th>Kcal</th>
            <th>P</th>
            <th>C</th>
            <th>F</th>
            <th></th>
        </tr>
    </thead>
    <tbody id="entriesBody">
        @foreach (var e in Model.Entries)
        {
            var mul = e.Grams / 100.0;
            <tr data-id="@e.Id">
                <td style="min-width:260px;">
                    <select class="form-select form-select-sm entryFood">
                        @foreach (var f in Model.Foods)
                        {
                            <option value="@f.Value" selected="@(f.Value == e.FoodItemId.ToString() ? "selected" : null)">
                                @f.Text
                            </option>
                        }
                    </select>
                </td>

                <td style="max-width:110px;">
                    <input class="form-control form-control-sm entryGrams" type="number" min="1" max="5000" value="@e.Grams" />
                </td>

                <td class="kcal">@Math.Round(mul * e.FoodItem!.KcalPer100g, 1)</td>
                <td class="p">@Math.Round(mul * e.FoodItem!.ProteinPer100g, 1)</td>
                <td class="c">@Math.Round(mul * e.FoodItem!.CarbsPer100g, 1)</td>
                <td class="f">@Math.Round(mul * e.FoodItem!.FatPer100g, 1)</td>

                <td style="white-space:nowrap;">
                    <button class="btn btn-sm btn-warning saveBtn">Uložiť</button>
                    <button class="btn btn-sm btn-danger delBtn">Zmazať</button>
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <script src="~/js/diary.js"></script>
}